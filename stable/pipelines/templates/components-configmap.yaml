apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "pipelines.fullname" . }}-components-config
  labels:
    app.kubernetes.io/name: {{ include "pipelines.name" . }}
    helm.sh/chart: {{ include "pipelines.chart" . }}
    app.kubernetes.io/instance: {{ .Release.Name }}
    app.kubernetes.io/managed-by: {{ .Release.Service }}
data:
  RUN_MODE: {{ .Values.runMode }}
  NODE_TLS_REJECT_UNAUTHORIZED: "1" 
  SHIPPABLE_API_URL: http://{{ include "pipelines.api.name" . }}:{{ .Values.api.service.port }}
  SHIPPABLE_INT_API_URL: http://{{ include "pipelines.api.name" . }}:{{ .Values.api.service.port }}
  {{- if (and .Values.api.ingress.enabled .Values.api.ingress.tls) }}
  {{- range .Values.api.ingress.hosts }}
  SHIPPABLE_PUBLIC_API_URL: https://{{ . }}
  SHIPPABLE_CONSOLE_API_URL: https://{{ . }}
  {{- end }}
  {{- else if .Values.api.ingress.enabled }}
  {{- range .Values.api.ingress.hosts }}
  SHIPPABLE_PUBLIC_API_URL: http://{{ . }}
  SHIPPABLE_CONSOLE_API_URL: http://{{ . }}
  {{- end }}
  {{- else }}
  SHIPPABLE_PUBLIC_API_URL: {{ .Values.api.externalUrl }}
  SHIPPABLE_CONSOLE_API_URL: {{ .Values.api.externalUrl }}
  {{- end }}
  {{- if (and .Values.www.ingress.enabled .Values.www.ingress.tls) }}
  {{- range .Values.www.ingress.hosts }}
  SHIPPABLE_WWW_URL: https://{{ . }}
  {{- end }}
  {{- else if .Values.www.ingress.enabled }}
  {{- range .Values.www.ingress.hosts }}
  SHIPPABLE_WWW_URL: http://{{ . }}
  {{- end }}
  {{- else }}
  SHIPPABLE_WWW_URL: {{ .Values.www.externalUrl }}
  {{- end }}
